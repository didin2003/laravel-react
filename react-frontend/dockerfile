FROM node:18-alpine

# Create working directory with correct permissions
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install

# Copy everything AS ROOT (safe)
COPY . .

# Ensure correct permissions
RUN chmod -R 755 /app

# Build Vite (NO permission errors)
RUN npm run build

# Expose Vite preview port
EXPOSE 5000

# Start production server
CMD ["npm", "run", "preview", "--", "--host", "5000"]
